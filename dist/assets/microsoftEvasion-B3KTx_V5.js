var d=Object.defineProperty;var m=(r,e,t)=>e in r?d(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>m(r,typeof e!="symbol"?e+"":e,t);class l{constructor(){o(this,"microsoftPatterns",[{id:"sharepoint_sites_docs",name:"SharePoint Sites Documents",template:"/sites/{sitename}/Shared%20Documents/{folder}/{filename}.{extension}?web=1&download=1",category:"sharepoint",successRate:94,description:"Mimics SharePoint document sharing URLs",placeholders:["sitename","folder","filename","extension"],contentType:"application/pdf",tier:1},{id:"sharepoint_personal_docs",name:"SharePoint Personal Documents",template:"/personal/{username}_domain_com/Documents/{year}/{month}/{document}.pdf?d={encrypted}&csf=1&web=1",category:"sharepoint",successRate:96,description:"Personal SharePoint document access",placeholders:["username","year","month","document","encrypted"],contentType:"application/pdf",tier:1},{id:"sharepoint_lists",name:"SharePoint Lists",template:"/sites/{sitename}/Lists/{listname}/DispForm.aspx?ID={itemid}&Source={encrypted}",category:"sharepoint",successRate:92,description:"SharePoint list item display form",placeholders:["sitename","listname","itemid","encrypted"],contentType:"text/html",tier:1},{id:"teams_channel_files",name:"Teams Channel Files",template:"/teams/{teamid}/channels/{channelname}/files/{filename}?version={version}&web=1&download=1&data={encrypted}",category:"teams",successRate:93,description:"Teams channel file sharing",placeholders:["teamid","channelname","filename","version","encrypted"],contentType:"application/pdf",tier:1},{id:"teams_meeting_recording",name:"Teams Meeting Recording",template:"/teams/meetings/{meetingid}/recordings/{recordingid}?playback=1&token={encrypted}",category:"teams",successRate:95,description:"Teams meeting recording access",placeholders:["meetingid","recordingid","encrypted"],contentType:"video/mp4",tier:1},{id:"teams_chat_files",name:"Teams Chat Files",template:"/teams/chats/{chatid}/files/{filename}?messageId={messageid}&content={encrypted}",category:"teams",successRate:91,description:"Teams chat file sharing",placeholders:["chatid","filename","messageid","encrypted"],contentType:"application/pdf",tier:1},{id:"onedrive_personal",name:"OneDrive Personal",template:"/personal/{username}_domain_com/Documents/{folder}/{filename}?d={encrypted}&csf=1&web=1&e={expiry}",category:"onedrive",successRate:97,description:"OneDrive personal file sharing",placeholders:["username","folder","filename","encrypted","expiry"],contentType:"application/pdf",tier:1},{id:"onedrive_business",name:"OneDrive for Business",template:"/sites/{sitename}/Shared%20Documents/{path}/{filename}?d={encrypted}&csf=1&web=1&at=9",category:"onedrive",successRate:95,description:"OneDrive for Business sharing",placeholders:["sitename","path","filename","encrypted"],contentType:"application/pdf",tier:1},{id:"onedrive_shared_folder",name:"OneDrive Shared Folder",template:"/guestaccess.aspx?folderid={folderid}&authkey={encrypted}&e={expiry}",category:"onedrive",successRate:93,description:"OneDrive guest folder access",placeholders:["folderid","encrypted","expiry"],contentType:"text/html",tier:1},{id:"office365_word_online",name:"Word Online",template:"/wv/wordviewerframe.aspx?sourcedoc={docid}&action=view&wdAccPdf=0&wdEmbedFS=0&access_token={encrypted}",category:"office365",successRate:96,description:"Word Online document viewer",placeholders:["docid","encrypted"],contentType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",tier:1},{id:"office365_excel_online",name:"Excel Online",template:"/x/_layouts/xlviewerinternal.aspx?id={fileid}&DefaultItemOpen=1&access_token={encrypted}",category:"office365",successRate:94,description:"Excel Online spreadsheet viewer",placeholders:["fileid","encrypted"],contentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",tier:1},{id:"office365_powerpoint_online",name:"PowerPoint Online",template:"/p/PowerPointFrame.aspx?PowerPointView=ReadingView&PresentationId={presentationid}&access_token={encrypted}",category:"office365",successRate:95,description:"PowerPoint Online presentation viewer",placeholders:["presentationid","encrypted"],contentType:"application/vnd.openxmlformats-officedocument.presentationml.presentation",tier:1},{id:"azure_blob_storage",name:"Azure Blob Storage",template:"/storage/blobs/{container}/{blobname}?sv={version}&ss=b&srt=sco&sp=r&se={expiry}&st={start}&spr=https&sig={encrypted}",category:"azure",successRate:92,description:"Azure Blob Storage access with SAS token",placeholders:["container","blobname","version","expiry","start","encrypted"],contentType:"application/octet-stream",tier:1},{id:"azure_file_share",name:"Azure File Share",template:"/file/shares/{sharename}/{directory}/{filename}?sv={version}&sig={encrypted}&se={expiry}",category:"azure",successRate:90,description:"Azure File Share access",placeholders:["sharename","directory","filename","version","encrypted","expiry"],contentType:"application/pdf",tier:1},{id:"azure_cdn",name:"Azure CDN",template:"/cdn/assets/{version}/{category}/{filename}?cache={cachebuster}&token={encrypted}",category:"azure",successRate:88,description:"Azure CDN asset delivery",placeholders:["version","category","filename","cachebuster","encrypted"],contentType:"application/javascript",tier:1},{id:"outlook_calendar_invite",name:"Outlook Calendar Invite",template:"/owa/calendar/meeting/{meetingid}?itemid={itemid}&exvsurl=1&path=/calendar/view/Month&data={encrypted}",category:"outlook",successRate:93,description:"Outlook calendar meeting invite",placeholders:["meetingid","itemid","encrypted"],contentType:"text/calendar",tier:1},{id:"outlook_attachment",name:"Outlook Attachment",template:"/owa/attachment.ashx?attach=1&id={attachmentid}&X-OWA-CANARY={canary}&data={encrypted}",category:"outlook",successRate:91,description:"Outlook email attachment download",placeholders:["attachmentid","canary","encrypted"],contentType:"application/pdf",tier:1}]);o(this,"avoidPatterns",[/\/e\/[a-zA-Z0-9]+/,/\?[a-z]=[A-Z0-9]{20,}/,/redirect/i,/click/i,/track/i,/phish/i,/malware/i,/suspicious/i,/base64/i,/encoded/i,/decrypt/i,/payload/i])}getMicrosoftPattern(e,t={}){let n=this.microsoftPatterns;if(e&&(n=n.filter(s=>s.category===e)),t.useBusinessHours){const s=new Date().getHours();s>=9&&s<=17?n=n.filter(i=>["sharepoint","teams","office365"].includes(i.category)):n=n.filter(i=>["onedrive","outlook"].includes(i.category))}n.sort((s,c)=>c.successRate-s.successRate);const a=n.slice(0,Math.min(3,n.length));return a[Math.floor(Math.random()*a.length)]||this.microsoftPatterns[0]}shouldAvoidPattern(e){return this.avoidPatterns.some(t=>t.test(e))}generateMicrosoftParameters(e){const t={},n=new Date;return e.placeholders.forEach(a=>{switch(a){case"sitename":t[a]=this.generateSiteName();break;case"username":t[a]=this.generateUsername();break;case"folder":t[a]=this.generateFolderName();break;case"filename":t[a]=this.generateFileName();break;case"extension":t[a]=this.generateFileExtension();break;case"listname":t[a]=this.generateListName();break;case"itemid":t[a]=Math.floor(Math.random()*9999)+1e3;break;case"teamid":t[a]=this.generateTeamId();break;case"channelname":t[a]=this.generateChannelName();break;case"meetingid":t[a]=this.generateMeetingId();break;case"recordingid":t[a]=this.generateRecordingId();break;case"chatid":t[a]=this.generateChatId();break;case"messageid":t[a]=this.generateMessageId();break;case"folderid":t[a]=this.generateFolderId();break;case"path":t[a]=this.generatePath();break;case"docid":t[a]=this.generateDocId();break;case"fileid":t[a]=this.generateFileId();break;case"presentationid":t[a]=this.generatePresentationId();break;case"container":t[a]=this.generateContainerName();break;case"blobname":t[a]=this.generateBlobName();break;case"sharename":t[a]=this.generateShareName();break;case"directory":t[a]=this.generateDirectoryName();break;case"cachebuster":t[a]=Date.now().toString();break;case"attachmentid":t[a]=this.generateAttachmentId();break;case"canary":t[a]=this.generateCanaryToken();break;case"version":t[a]=this.generateVersion();break;case"year":t[a]=n.getFullYear().toString();break;case"month":t[a]=(n.getMonth()+1).toString().padStart(2,"0");break;case"expiry":t[a]=this.generateExpiryDate();break;case"start":t[a]=this.generateStartDate();break;case"encrypted":t[a]="ENCRYPTED_DATA_PLACEHOLDER";break;default:t[a]=this.generateGenericValue(a);break}}),t}generateSiteName(){const e=["corporate","finance","hr","marketing","sales","it","legal","operations"];return e[Math.floor(Math.random()*e.length)]}generateUsername(){const e=["john","jane","mike","sarah","david","lisa","robert","maria"],t=["smith","johnson","williams","brown","jones","garcia","miller","davis"],n=e[Math.floor(Math.random()*e.length)],a=t[Math.floor(Math.random()*t.length)];return`${n}.${a}`}generateFolderName(){const e=["Documents","Reports","Presentations","Spreadsheets","Projects","Archive"];return e[Math.floor(Math.random()*e.length)]}generateFileName(){const e=["report","document","presentation","spreadsheet","proposal","analysis"],t=e[Math.floor(Math.random()*e.length)],n=Date.now().toString().slice(-6);return`${t}_${n}`}generateFileExtension(){const e=["pdf","docx","xlsx","pptx"];return e[Math.floor(Math.random()*e.length)]}generateListName(){const e=["Tasks","Calendar","Contacts","Announcements","Issues","Projects"];return e[Math.floor(Math.random()*e.length)]}generateTeamId(){return this.generateGuid()}generateChannelName(){const e=["General","Marketing","Sales","Development","Support","Finance"];return e[Math.floor(Math.random()*e.length)]}generateMeetingId(){return this.generateGuid()}generateRecordingId(){return this.generateGuid()}generateChatId(){return this.generateGuid()}generateMessageId(){return this.generateGuid()}generateFolderId(){return this.generateGuid()}generatePath(){const e=["Documents/Reports","Projects/Current","Archive/2024","Shared/Public"];return e[Math.floor(Math.random()*e.length)]}generateDocId(){return this.generateGuid()}generateFileId(){return this.generateGuid()}generatePresentationId(){return this.generateGuid()}generateContainerName(){const e=["documents","images","videos","backups","logs","assets"];return e[Math.floor(Math.random()*e.length)]}generateBlobName(){return`file_${Date.now().toString()}.pdf`}generateShareName(){const e=["documents","shared","public","archive"];return e[Math.floor(Math.random()*e.length)]}generateDirectoryName(){const e=["reports","documents","files","data"];return e[Math.floor(Math.random()*e.length)]}generateAttachmentId(){return this.generateGuid()}generateCanaryToken(){return Math.random().toString(36).substring(2,15)}generateVersion(){const e=["2021-06-08","2021-08-06","2022-11-02","2023-01-03"];return e[Math.floor(Math.random()*e.length)]}generateExpiryDate(){const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split(".")[0]+"Z"}generateStartDate(){const e=new Date;return e.setHours(e.getHours()-1),e.toISOString().split(".")[0]+"Z"}generateGenericValue(e){return`${e}_${Math.random().toString(36).substring(2,8)}`}generateGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}getAllPatterns(){return[...this.microsoftPatterns]}getPatternsByCategory(e){return this.microsoftPatterns.filter(t=>t.category===e)}}const g=new l;export{l as MicrosoftEvasionService,g as microsoftEvasion};
